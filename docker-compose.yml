services:
  bridge:
    build: .
    container_name: cli-team-bridge
    volumes:
      - .:/app                                                    # Bridge source (live reload)
      - /Users/tonyholovka/.claude/tasks:/home/bridge/.claude/tasks  # Task files only (not full .claude)
      - /Users/tonyholovka/workspace:/workspace:ro                # Project workspaces (read-only)
      - node_modules:/app/node_modules                            # Persist deps
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - KIMI_API_KEY=${KIMI_API_KEY}
      - OLLAMA_HOST=${OLLAMA_HOST:-host.docker.internal:11434}
    working_dir: /app
    command: bun run src/index.ts --team ${TEAM_ID:-test-bridge} --config bridge.config.json --mode watcher
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  node_modules:
